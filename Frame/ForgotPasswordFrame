/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package com.shop.Frame;

import com.shop.DbConnection.DbConnection;
import java.awt.HeadlessException;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import javax.swing.JOptionPane;

/**
 *
 * @author Jatendar
 */
public class ForgotPasswordFrame extends javax.swing.JFrame {

    /**
     * Creates new form ForgotPasswordFrame
     */
    public ForgotPasswordFrame() {
        initComponents();
        setLocation(200, 200);
    }
    static Connection con = DbConnection.getConnection();

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">                          
    private void initComponents() {

        jLabel1 = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        jLabel3 = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        jLabel5 = new javax.swing.JLabel();
        usernameText = new javax.swing.JTextField();
        oldText = new javax.swing.JPasswordField();
        newText = new javax.swing.JPasswordField();
        confirmText = new javax.swing.JPasswordField();
        changeButton = new javax.swing.JButton();
        usernameLable = new javax.swing.JLabel();
        oldLable = new javax.swing.JLabel();
        confirmLable = new javax.swing.JLabel();
        clearButton = new javax.swing.JButton();
        loginButton = new javax.swing.JButton();
        oldPasswordBox = new javax.swing.JCheckBox();
        newPasswordBox = new javax.swing.JCheckBox();
        confirmPasswordBox = new javax.swing.JCheckBox();
        jLabel6 = new javax.swing.JLabel();
        jLabel7 = new javax.swing.JLabel();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        getContentPane().setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        jLabel1.setFont(new java.awt.Font("Times New Roman", 1, 36)); // NOI18N
        jLabel1.setForeground(new java.awt.Color(255, 255, 255));
        jLabel1.setText("Change Password");
        getContentPane().add(jLabel1, new org.netbeans.lib.awtextra.AbsoluteConstraints(10, 11, 291, 51));

        jLabel2.setFont(new java.awt.Font("Times New Roman", 1, 12)); // NOI18N
        jLabel2.setText("Username ");
        getContentPane().add(jLabel2, new org.netbeans.lib.awtextra.AbsoluteConstraints(79, 68, 87, 22));

        jLabel3.setFont(new java.awt.Font("Times New Roman", 1, 12)); // NOI18N
        jLabel3.setText("Old Password");
        getContentPane().add(jLabel3, new org.netbeans.lib.awtextra.AbsoluteConstraints(79, 115, 87, 22));

        jLabel4.setFont(new java.awt.Font("Times New Roman", 1, 14)); // NOI18N
        jLabel4.setText("New Password");
        getContentPane().add(jLabel4, new org.netbeans.lib.awtextra.AbsoluteConstraints(77, 154, 89, 22));

        jLabel5.setFont(new java.awt.Font("Times New Roman", 1, 12)); // NOI18N
        jLabel5.setText("Cofirm Password");
        getContentPane().add(jLabel5, new org.netbeans.lib.awtextra.AbsoluteConstraints(77, 196, -1, 22));

        usernameText.setFont(new java.awt.Font("Times New Roman", 1, 14)); // NOI18N
        usernameText.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(51, 255, 51), 2));
        getContentPane().add(usernameText, new org.netbeans.lib.awtextra.AbsoluteConstraints(172, 68, 141, 22));

        oldText.setFont(new java.awt.Font("Times New Roman", 1, 14)); // NOI18N
        oldText.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(51, 255, 51), 2));
        getContentPane().add(oldText, new org.netbeans.lib.awtextra.AbsoluteConstraints(172, 115, 141, 22));

        newText.setFont(new java.awt.Font("Times New Roman", 1, 14)); // NOI18N
        newText.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(51, 255, 51), 2));
        getContentPane().add(newText, new org.netbeans.lib.awtextra.AbsoluteConstraints(172, 155, 141, 22));

        confirmText.setFont(new java.awt.Font("Times New Roman", 1, 14)); // NOI18N
        confirmText.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(51, 255, 51), 2));
        getContentPane().add(confirmText, new org.netbeans.lib.awtextra.AbsoluteConstraints(172, 196, 141, 22));

        changeButton.setFont(new java.awt.Font("Times New Roman", 1, 18)); // NOI18N
        changeButton.setText("Confirm");
        changeButton.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(51, 255, 0), 2));
        changeButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                changeButtonActionPerformed(evt);
            }
        });
        getContentPane().add(changeButton, new org.netbeans.lib.awtextra.AbsoluteConstraints(53, 242, 113, 35));

        usernameLable.setFont(new java.awt.Font("Times New Roman", 1, 12)); // NOI18N
        usernameLable.setForeground(new java.awt.Color(255, 0, 51));
        getContentPane().add(usernameLable, new org.netbeans.lib.awtextra.AbsoluteConstraints(172, 96, 141, 12));

        oldLable.setFont(new java.awt.Font("Times New Roman", 1, 14)); // NOI18N
        oldLable.setForeground(new java.awt.Color(255, 0, 0));
        getContentPane().add(oldLable, new org.netbeans.lib.awtextra.AbsoluteConstraints(172, 139, 141, 12));

        confirmLable.setFont(new java.awt.Font("Times New Roman", 1, 12)); // NOI18N
        confirmLable.setForeground(new java.awt.Color(255, 0, 51));
        getContentPane().add(confirmLable, new org.netbeans.lib.awtextra.AbsoluteConstraints(172, 224, 141, 12));

        clearButton.setFont(new java.awt.Font("Times New Roman", 1, 18)); // NOI18N
        clearButton.setText("Clear");
        clearButton.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(51, 255, 0), 2));
        clearButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                clearButtonActionPerformed(evt);
            }
        });
        getContentPane().add(clearButton, new org.netbeans.lib.awtextra.AbsoluteConstraints(200, 242, 113, 35));

        loginButton.setBackground(new java.awt.Color(51, 255, 51));
        loginButton.setFont(new java.awt.Font("Times New Roman", 1, 18)); // NOI18N
        loginButton.setText("Login");
        loginButton.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(51, 255, 0), 2));
        loginButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                loginButtonActionPerformed(evt);
            }
        });
        getContentPane().add(loginButton, new org.netbeans.lib.awtextra.AbsoluteConstraints(338, 11, 113, 35));

        oldPasswordBox.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        oldPasswordBox.setText("Show Password");
        oldPasswordBox.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(51, 0, 255), 2));
        oldPasswordBox.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                oldPasswordBoxActionPerformed(evt);
            }
        });
        getContentPane().add(oldPasswordBox, new org.netbeans.lib.awtextra.AbsoluteConstraints(319, 114, 132, 22));

        newPasswordBox.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        newPasswordBox.setText("Show Password");
        newPasswordBox.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(51, 0, 255), 2));
        newPasswordBox.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                newPasswordBoxActionPerformed(evt);
            }
        });
        getContentPane().add(newPasswordBox, new org.netbeans.lib.awtextra.AbsoluteConstraints(319, 154, 132, 22));

        confirmPasswordBox.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        confirmPasswordBox.setText("Show Password");
        confirmPasswordBox.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(51, 0, 255), 2));
        confirmPasswordBox.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                confirmPasswordBoxActionPerformed(evt);
            }
        });
        getContentPane().add(confirmPasswordBox, new org.netbeans.lib.awtextra.AbsoluteConstraints(319, 195, 132, 22));

        jLabel6.setIcon(new javax.swing.ImageIcon("C:\\Users\\Jatendar\\OneDrive\\Desktop\\MallManagementSystem\\blue background.jpg")); // NOI18N
        getContentPane().add(jLabel6, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 0, 460, 60));

        jLabel7.setIcon(new javax.swing.ImageIcon("C:\\Users\\Jatendar\\OneDrive\\Desktop\\MallManagementSystem\\dfadf.jpg")); // NOI18N
        getContentPane().add(jLabel7, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 60, 460, 230));

        pack();
    }// </editor-fold>                        

    private void changeButtonActionPerformed(java.awt.event.ActionEvent evt) {                                             
        String username, oldPassword, newPassword, confirmPassword;
        username = usernameText.getText();
        oldPassword = oldText.getText();
        newPassword = newText.getText();
        confirmPassword = confirmText.getText();

        String checkQuery = "select * from users where username = '" + username + "'";
        String updateQuery = "update users set password = '" + newPassword + "' where  username = '" + username + "'";
        try {
            PreparedStatement ps = con.prepareStatement(checkQuery);
            ResultSet set = ps.executeQuery();
            if (set.next()) {
                if (set.getString("password").equals(oldPassword) && set.getString("username").equals(username)) {
                    oldLable.setText("");
                    if (newPassword.equals(confirmPassword)) {
                        confirmLable.setText("");
                        ps.executeUpdate(updateQuery);
                        JOptionPane.showMessageDialog(this, "Password Change Successfully");

                    } else {
                        confirmLable.setText("Confirm Password Does Not Match");
                        confirmText.requestFocus();
                    }
                } else {
                    oldLable.setText("Invalid Old Password");
                    oldText.requestFocus();
                }
                usernameLable.setText("");
            } else {
                usernameLable.setText("Invalid Username");
                usernameText.requestFocus();
            }
        } catch (HeadlessException | SQLException e) {
            e.printStackTrace();
        }


    }                                            

    private void clearButtonActionPerformed(java.awt.event.ActionEvent evt) {                                            
        usernameText.setText("");
        oldText.setText("");
        newText.setText("");
        confirmText.setText("");
        usernameLable.setText("");
        oldLable.setText("");
        newText.setText("");
        confirmLable.setText("");
    }                                           

    private void loginButtonActionPerformed(java.awt.event.ActionEvent evt) {                                            
        LoginFrame frame = new LoginFrame();
        frame.setVisible(true);
        this.dispose();
    }                                           

    private void oldPasswordBoxActionPerformed(java.awt.event.ActionEvent evt) {                                               
        if (oldPasswordBox.isSelected()) {
            oldText.setEchoChar((char) 0);
        } else {
            oldText.setEchoChar('*');
        }
    }                                              

    private void newPasswordBoxActionPerformed(java.awt.event.ActionEvent evt) {                                               
        if (newPasswordBox.isSelected()) {
            newText.setEchoChar((char) 0);
        } else {
            newText.setEchoChar('*');
        }
    }                                              

    private void confirmPasswordBoxActionPerformed(java.awt.event.ActionEvent evt) {                                                   
        if (confirmPasswordBox.isSelected()) {
            confirmText.setEchoChar((char) 0);
        } else {
            confirmText.setEchoChar('*');
        }
    }                                                  

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(ForgotPasswordFrame.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(ForgotPasswordFrame.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(ForgotPasswordFrame.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(ForgotPasswordFrame.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new ForgotPasswordFrame().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify                     
    private javax.swing.JButton changeButton;
    private javax.swing.JButton clearButton;
    private javax.swing.JLabel confirmLable;
    private javax.swing.JCheckBox confirmPasswordBox;
    private javax.swing.JPasswordField confirmText;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JButton loginButton;
    private javax.swing.JCheckBox newPasswordBox;
    private javax.swing.JPasswordField newText;
    private javax.swing.JLabel oldLable;
    private javax.swing.JCheckBox oldPasswordBox;
    private javax.swing.JPasswordField oldText;
    private javax.swing.JLabel usernameLable;
    private javax.swing.JTextField usernameText;
    // End of variables declaration                   
}
